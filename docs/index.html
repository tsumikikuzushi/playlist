<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>私選ゲームBGM Player</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="container">
    <!-- YouTubeプレイヤー -->
    <div class="player">
      <iframe id="player" src="" allowfullscreen></iframe>
    </div>

    <!-- プレイリスト切り替え -->
    <div class="playlist-selector">
      <label for="playlist">プレイリストを選択: </label>
      <select id="playlist"></select>
    </div>

    <!-- 動画リスト -->
    <div id="list" class="list-container"></div>
  </div>

  <script>
    let playlistsData = {};
    let currentPlaylist = "";
    let currentVideoIndex = 0;

    // JSON読み込み
    async function loadPlaylists() {
      try {
        const response = await fetch("playlists.json");
        if (!response.ok) throw new Error("JSON読み込み失敗");
        playlistsData = await response.json();

        const selector = document.getElementById("playlist");
        selector.innerHTML = "";

        // セレクタにプレイリスト追加
        Object.keys(playlistsData).forEach((key, index) => {
          const option = document.createElement("option");
          option.value = key;
          option.textContent = playlistsData[key].title;
          selector.appendChild(option);

          if (index === 0) {
            currentPlaylist = key;
          }
        });

        // 最初のプレイリストを表示
        loadPlaylist(currentPlaylist);

        // セレクタ変更時の処理
        selector.addEventListener("change", (e) => {
          currentPlaylist = e.target.value;
          loadPlaylist(currentPlaylist);
        });

      } catch (err) {
        console.error("プレイリスト読み込みエラー:", err);
      }
    }

    // プレイリスト切り替え
    function loadPlaylist(key) {
      const videos = playlistsData[key].videos;
      currentVideoIndex = 0;
      renderList(videos);
      loadVideo(videos[currentVideoIndex].videoId);
    }

    // プレイヤーに動画を読み込む
    function loadVideo(videoId) {
      document.getElementById("player").src = 
        `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
    }

    // 動画リストを描画
    function renderList(videos) {
      const list = document.getElementById("list");
      list.innerHTML = "";
      videos.forEach((video, index) => {
        const item = document.createElement("div");
        item.className = "video-item";
        item.innerHTML = `
          <img src="${video.thumbnail}" alt="${video.musicTitle}">
          <div class="video-info">
            <div class="music-title">${video.musicTitle}</div>
            <div class="game-title">${video.gameTitle}</div>
          </div>
        `;
        item.addEventListener("click", () => {
          currentVideoIndex = index;
          loadVideo(video.videoId);
        });
        list.appendChild(item);
      });
    }

    // 初期化
    loadPlaylists();
  </script>
</body>
</html>
