<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>音声再生リストプレイヤー</title>
<script src="https://www.youtube.com/iframe_api"></script>
<style>
body { font-family:sans-serif; margin:1rem; text-align:center; background:#f9f9f9; }
h2 { margin-bottom:1rem; }

/* サムネイル縦並び */
.thumbnail-container { 
  display:flex; 
  flex-direction: column; /* 縦並び */
  align-items: center;
  margin-top:1.5rem; 
}
.thumbnail { 
  display:flex; 
  flex-direction: column;
  align-items: center;
  margin:0.5rem; 
  cursor:pointer; 
  border:2px solid transparent; 
}
.thumbnail.selected { border-color:#007bff; }
.thumbnail img { width:160px; height:90px; display:block; }
.thumbnail span { 
  display:block; 
  font-size:1rem; 
  margin-top:0.2rem; 
  max-width:160px; 
  word-wrap:break-word; 
}

/* YouTube iframe 非表示 */
#player {
  width:0;
  height:0;
  position:absolute;
  left:-9999px;
}
</style>
</head>
<body>

<h2>🔊 音声再生リストプレイヤー</h2>
<div class="list-select" id="listSelectContainer"></div>

<!-- iframe非表示 -->
<div id="player"></div>

<script>
let playlists = {};
let currentPlaylist = [];
let currentIndex = 0;
let player;

// JSON読み込み
fetch('playlists.json')
  .then(res => res.json())
  .then(data => {
    playlists = data;
    const container = document.getElementById('listSelectContainer');

    Object.keys(playlists).forEach(key => {
      const pl = playlists[key];
      pl.videos.forEach((video, vIdx) => {
        const div = document.createElement('div');
        div.className = 'thumbnail';
        div.dataset.playlist = key;
        div.dataset.index = vIdx;
        div.innerHTML = `<img src="${video.thumbnail}" alt="${video.gameTitle}">
                         <span>${video.gameTitle}<br>${video.musicTitle}</span>`;
        div.addEventListener('click', () => {
          currentPlaylist = pl.videos;
          currentIndex = vIdx;
          loadVideo(currentIndex);
          updateSelectedThumbnail(container, div);
        });
        container.appendChild(div);
      });
    });
  })
  .catch(err => console.error('JSON読み込みエラー:', err));

function updateSelectedThumbnail(container, selectedDiv) {
  Array.from(container.children).forEach(div => div.classList.remove('selected'));
  selectedDiv.classList.add('selected');
}

// YouTube API準備完了
function onYouTubeIframeAPIReady() {
  if (currentPlaylist.length > 0) loadVideo(currentIndex);
}

// 動画ロード（音声のみ再生）
function loadVideo(index) {
  const video = currentPlaylist[index];
  if (!video) return;

  const start = video.start ?? 0;
  const end = video.end ?? undefined;

  if (player) {
    player.loadVideoById({ videoId: video.videoId, startSeconds: start, endSeconds: end });
  } else {
    player = new YT.Player("player", {
      videoId: video.videoId,
      playerVars: { start: start, end: end, autoplay:0, controls:0 }
    });
  }
}
</script>

</body>
</html>
